[{"name":"app.R","content":"library(shiny)\r\nlibrary(bslib)\r\nlibrary(ggplot2)\r\nlibrary(latex2exp)\r\n\r\nui <- page_fluid(\r\n  theme = bs_theme(bootswatch = \"flatly\"),\r\n  \r\n  h1(\"威布尔分布\"),\r\n  \r\n  layout_sidebar(\r\n    sidebar = sidebar(\r\n      title = \"参数设置\",\r\n      \r\n      sliderInput(\"shape\", \"形状参数 (k):\", \r\n                  min = 0.1, max = 5, value = 1.5, step = 0.1),\r\n      \r\n      sliderInput(\"scale\", \"尺度参数 (λ):\", \r\n                  min = 0.1, max = 5, value = 1, step = 0.1),\r\n      \r\n      sliderInput(\"xlim\", \"x轴范围:\", \r\n                  min = 0, max = 10, value = c(0, 5), step = 0.1),\r\n      \r\n      # 显示均值和方差\r\n      verbatimTextOutput(\"meanvar\")\r\n    ),\r\n    \r\n    # 使用navset_card_tab创建三个标签页\r\n    navset_card_tab(\r\n      # 第一个标签页：分布信息\r\n      nav_panel(\r\n        title = \"基本信息\",\r\n        card(\r\n          card_body(\r\n            p(\"威布尔分布(Weibull Distribution)是可靠性工程与生存分析中常用的概率分布。它能够描述各种形态的失效率函数，非常适合模拟系统的寿命数据。\"),\r\n            p(\"威布尔分布有两个参数：\"),\r\n            tags$ul(\r\n              tags$li(\"形状参数 k (shape): 决定了分布的形状\"),\r\n              tags$li(\"尺度参数 λ (scale): 决定了分布的尺度\")\r\n            ),\r\n            \r\n            h4(\"数学公式\"),\r\n            withMathJax(),\r\n            p(\"概率密度函数 (PDF):\"),\r\n            p(\"$$f(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}e^{-(t/\\\\lambda)^k}, \\\\quad t \\\\geq 0$$\"),\r\n            \r\n            p(\"累积分布函数 (CDF):\"),\r\n            p(\"$$F(t) = 1 - e^{-(t/\\\\lambda)^k}, \\\\quad t \\\\geq 0$$\"),\r\n            \r\n            p(\"生存函数 (Survival function):\"),\r\n            p(\"$$S(t) = e^{-(t/\\\\lambda)^k}, \\\\quad t \\\\geq 0$$\"),\r\n            \r\n            p(\"风险函数/危险率函数 (Hazard function):\"),\r\n            p(\"$$h(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}, \\\\quad t \\\\geq 0$$\"),\r\n            \r\n            h4(\"统计特性\"),\r\n            p(\"均值 (Mean):\"),\r\n            p(\"$$E(T) = \\\\lambda \\\\Gamma(1 + \\\\frac{1}{k})$$\"),\r\n            p(\"其中Γ是伽马函数。\"),\r\n            \r\n            p(\"方差 (Variance):\"),\r\n            p(\"$$Var(T) = \\\\lambda^2 \\\\left[ \\\\Gamma(1 + \\\\frac{2}{k}) - \\\\Gamma^2(1 + \\\\frac{1}{k}) \\\\right]$$\")\r\n          )\r\n        ),\r\n      ),\r\n      nav_panel(\r\n        title='生存分析中的应用',\r\n        card(\r\n          p(\"在生存分析中，威布尔分布具有重要意义：\"),\r\n          \r\n          h4(\"1. 生存函数 S(t)\"),\r\n          p(\"表示个体在时间t后仍然存活的概率。威布尔分布的生存函数为：\"),\r\n          p(\"$$S(t) = e^{-(t/\\\\lambda)^k}$$\"),\r\n          \r\n          h4(\"2. 危险率函数 h(t)\"),\r\n          p(\"表示在时间t存活的个体在下一时刻发生事件的瞬时概率。威布尔分布的危险率函数为：\"),\r\n          p(\"$$h(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}$$\"),\r\n          p(\"当k < 1时，危险率随时间减少，表示早期故障；\"),\r\n          p(\"当k = 1时，危险率恒定，简化为指数分布；\"),\r\n          p(\"当k > 1时，危险率随时间增加，表示磨损故障。\"),\r\n          \r\n          h4(\"3. 概率密度函数 f(t)\"),\r\n          p(\"表示事件发生时间的概率密度。威布尔分布的概率密度函数为：\"),\r\n          p(\"$$f(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}e^{-(t/\\\\lambda)^k}$$\"),\r\n          \r\n          h4(\"应用场景\"),\r\n          p(\"威布尔分布在生存分析中广泛应用于：\"),\r\n          tags$ul(\r\n            tags$li(\"医学研究：分析患者存活时间\"),\r\n            tags$li(\"工程可靠性：预测设备失效时间\"),\r\n            tags$li(\"工业制造：研究产品寿命\"),\r\n            tags$li(\"保险精算：寿险和健康保险模型\")\r\n          )\r\n        )\r\n      ),\r\n      \r\n      # 第二个标签页：图形可视化\r\n      nav_panel(\r\n        title = \"分布图形\",\r\n        layout_column_wrap(\r\n          width = 1/2,\r\n          card(\r\n            card_header(\"概率密度函数 (PDF)\"),\r\n            plotOutput(\"pdfPlot\")\r\n          ),\r\n          card(\r\n            card_header(\"生存函数 (Survival Function)\"),\r\n            plotOutput(\"survivalPlot\")\r\n          )\r\n        ),\r\n        \r\n        layout_column_wrap(\r\n          width = 1/2,\r\n          card(\r\n            card_header(\"危险率函数 (Hazard Function)\"),\r\n            plotOutput(\"hazardPlot\")\r\n          ),\r\n          card(\r\n            card_header(\"累积分布函数 (CDF)\"),\r\n            plotOutput(\"cdfPlot\")\r\n          )\r\n        )\r\n      ),\r\n      \r\n      # 第三个标签页：参数影响\r\n      nav_panel(\r\n        title = \"参数影响分析\",\r\n        layout_column_wrap(\r\n          width = 1/3,\r\n          card(\r\n            card_header(\"形状参数(k)的影响\"),\r\n            card_body(\r\n              p(\"形状参数k对威布尔分布有显著影响:\"),\r\n              tags$ul(\r\n                tags$li(strong(\"k < 1: \"), \"危险率随时间减少。分布呈现出较高的初始失效率，适用于描述早期故障或婴儿期故障。\"),\r\n                tags$li(strong(\"k = 1: \"), \"危险率恒定，威布尔分布简化为指数分布。适用于描述随机故障。\"),\r\n                tags$li(strong(\"k > 1: \"), \"危险率随时间增加，适用于描述磨损故障。\"),\r\n                tags$li(strong(\"k ≈ 3.5: \"), \"威布尔分布近似正态分布。\")\r\n              ),\r\n              plotOutput(\"shapeEffect\")\r\n            )\r\n          ),\r\n          card(\r\n            card_header(\"尺度参数(λ)的影响\"),\r\n            card_body(\r\n              p(\"尺度参数λ主要影响分布的尺度（拉伸或压缩）:\"),\r\n              tags$ul(\r\n                tags$li(\"λ增大：分布向右拉伸，均值增加\"),\r\n                tags$li(\"λ减小：分布向左压缩，均值减小\"),\r\n                tags$li(\"λ等效于时间的单位变换\")\r\n              ),\r\n              plotOutput(\"scaleEffect\")\r\n            )\r\n          ),\r\n          card(\r\n            card_header(\"参数与统计特性的关系\"),\r\n            card_body(\r\n              p(\"参数变化对均值和方差的影响:\"),\r\n              withMathJax(),\r\n              p(\"当k固定时，λ增大会导致均值和方差同比例增加。\"),\r\n              p(\"当λ固定时，k的变化对均值和方差的影响更为复杂：\"),\r\n              tags$ul(\r\n                tags$li(\"k增大通常会使分布更加集中（方差减小）\"),\r\n                tags$li(\"当k接近3.6时，分布的偏度接近于0，最接近正态分布\")\r\n              ),\r\n              plotOutput(\"momentPlot\")\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  )\r\n)\r\n\r\nserver <- function(input, output) {\r\n  # 创建x轴数据点\r\n  x_values <- reactive({\r\n    seq(input$xlim[1], input$xlim[2], length.out = 500)\r\n  })\r\n  \r\n  # 计算威布尔PDF\r\n  weibull_pdf <- reactive({\r\n    dweibull(x_values(), shape = input$shape, scale = input$scale)\r\n  })\r\n  \r\n  # 计算威布尔CDF\r\n  weibull_cdf <- reactive({\r\n    pweibull(x_values(), shape = input$shape, scale = input$scale)\r\n  })\r\n  \r\n  # 计算威布尔生存函数\r\n  weibull_survival <- reactive({\r\n    1 - weibull_cdf()\r\n  })\r\n  \r\n  # 计算威布尔危险率函数\r\n  weibull_hazard <- reactive({\r\n    k <- input$shape\r\n    lambda <- input$scale\r\n    t <- x_values()\r\n    k/lambda * (t/lambda)^(k-1)\r\n  })\r\n  \r\n  # 绘制PDF图\r\n  output$pdfPlot <- renderPlot({\r\n    df <- data.frame(x = x_values(), y = weibull_pdf())\r\n    \r\n    ggplot(df, aes(x = x, y = y)) +\r\n      geom_line(color = \"#1f77b4\", size = 1.2) +\r\n      labs(\r\n        x = \"时间 (t)\",\r\n        y = \"概率密度 f(t)\",\r\n        title = paste0(\"威布尔PDF (k=\", input$shape, \", λ=\", input$scale, \")\")\r\n      ) +\r\n      theme_minimal(base_size = 14) +\r\n      theme(plot.title = element_text(hjust = 0.5)) +\r\n      coord_cartesian(xlim = input$xlim)\r\n  })\r\n  \r\n  # 绘制CDF图\r\n  output$cdfPlot <- renderPlot({\r\n    df <- data.frame(x = x_values(), y = weibull_cdf())\r\n    \r\n    ggplot(df, aes(x = x, y = y)) +\r\n      geom_line(color = \"#ff7f0e\", size = 1.2) +\r\n      labs(\r\n        x = \"时间 (t)\",\r\n        y = \"累积概率 F(t)\",\r\n        title = paste0(\"威布尔CDF (k=\", input$shape, \", λ=\", input$scale, \")\")\r\n      ) +\r\n      theme_minimal(base_size = 14) +\r\n      theme(plot.title = element_text(hjust = 0.5)) +\r\n      coord_cartesian(xlim = input$xlim)\r\n  })\r\n  \r\n  # 绘制生存函数图\r\n  output$survivalPlot <- renderPlot({\r\n    df <- data.frame(x = x_values(), y = weibull_survival())\r\n    \r\n    ggplot(df, aes(x = x, y = y)) +\r\n      geom_line(color = \"#2ca02c\", size = 1.2) +\r\n      labs(\r\n        x = \"时间 (t)\",\r\n        y = \"生存概率 S(t)\",\r\n        title = paste0(\"威布尔生存函数 (k=\", input$shape, \", λ=\", input$scale, \")\")\r\n      ) +\r\n      theme_minimal(base_size = 14) +\r\n      theme(plot.title = element_text(hjust = 0.5)) +\r\n      coord_cartesian(xlim = input$xlim)\r\n  })\r\n  \r\n  # 绘制危险率函数图\r\n  output$hazardPlot <- renderPlot({\r\n    df <- data.frame(x = x_values(), y = weibull_hazard())\r\n    \r\n    ggplot(df, aes(x = x, y = y)) +\r\n      geom_line(color = \"#d62728\", size = 1.2) +\r\n      labs(\r\n        x = \"时间 (t)\",\r\n        y = \"危险率 h(t)\",\r\n        title = paste0(\"威布尔危险率函数 (k=\", input$shape, \", λ=\", input$scale, \")\")\r\n      ) +\r\n      theme_minimal(base_size = 14) +\r\n      theme(plot.title = element_text(hjust = 0.5)) +\r\n      coord_cartesian(xlim = input$xlim)\r\n  })\r\n  \r\n  # 绘制形状参数影响图\r\n  output$shapeEffect <- renderPlot({\r\n    x <- seq(0, 5, length.out = 500)\r\n    shapes <- c(0.5, 1, 1.5, 3, 5)\r\n    \r\n    df <- data.frame()\r\n    for(shape in shapes) {\r\n      temp_df <- data.frame(\r\n        x = x,\r\n        y = dweibull(x, shape = shape, scale = input$scale),\r\n        shape = paste(\"k =\", shape)\r\n      )\r\n      df <- rbind(df, temp_df)\r\n    }\r\n    \r\n    ggplot(df, aes(x = x, y = y, color = shape)) +\r\n      geom_line(size = 1) +\r\n      labs(\r\n        x = \"时间 (t)\",\r\n        y = \"概率密度 f(t)\",\r\n        title = \"不同形状参数(k)的影响\",\r\n        color = \"形状参数\"\r\n      ) +\r\n      theme_minimal() +\r\n      theme(\r\n        plot.title = element_text(hjust = 0.5),\r\n        legend.position = \"bottom\"\r\n      ) +\r\n      scale_color_brewer(palette = \"Set1\")\r\n  })\r\n  \r\n  # 绘制尺度参数影响图\r\n  output$scaleEffect <- renderPlot({\r\n    x <- seq(0, 5, length.out = 500)\r\n    scales <- c(0.5, 1, 1.5, 2, 3)\r\n    \r\n    df <- data.frame()\r\n    for(scale in scales) {\r\n      temp_df <- data.frame(\r\n        x = x,\r\n        y = dweibull(x, shape = input$shape, scale = scale),\r\n        scale = paste(\"λ =\", scale)\r\n      )\r\n      df <- rbind(df, temp_df)\r\n    }\r\n    \r\n    ggplot(df, aes(x = x, y = y, color = scale)) +\r\n      geom_line(size = 1) +\r\n      labs(\r\n        x = \"时间 (t)\",\r\n        y = \"概率密度 f(t)\",\r\n        title = \"不同尺度参数(λ)的影响\",\r\n        color = \"尺度参数\"\r\n      ) +\r\n      theme_minimal() +\r\n      theme(\r\n        plot.title = element_text(hjust = 0.5),\r\n        legend.position = \"bottom\"\r\n      ) +\r\n      scale_color_brewer(palette = \"Set2\")\r\n  })\r\n  \r\n  # 绘制均值和方差与参数关系图\r\n  output$momentPlot <- renderPlot({\r\n    # 创建数据\r\n    k_values <- seq(0.2, 5, by = 0.1)\r\n    lambda_values <- c(0.5, 1, 2, 3)\r\n    \r\n    df <- data.frame()\r\n    \r\n    for(lambda in lambda_values) {\r\n      means <- sapply(k_values, function(k) lambda * gamma(1 + 1/k))\r\n      variances <- sapply(k_values, function(k) lambda^2 * (gamma(1 + 2/k) - (gamma(1 + 1/k))^2))\r\n      \r\n      mean_df <- data.frame(\r\n        x = k_values,\r\n        y = means,\r\n        parameter = paste0(\"λ = \", lambda),\r\n        type = \"均值\"\r\n      )\r\n      \r\n      var_df <- data.frame(\r\n        x = k_values,\r\n        y = variances,\r\n        parameter = paste0(\"λ = \", lambda),\r\n        type = \"方差\"\r\n      )\r\n      \r\n      df <- rbind(df, mean_df, var_df)\r\n    }\r\n    \r\n    # 绘图\r\n    ggplot(df, aes(x = x, y = y, color = parameter, linetype = type)) +\r\n      geom_line(size = 1) +\r\n      labs(\r\n        x = \"形状参数 (k)\",\r\n        y = \"值\",\r\n        title = \"形状参数(k)对均值和方差的影响\",\r\n        color = \"尺度参数\",\r\n        linetype = \"统计量\"\r\n      ) +\r\n      theme_minimal() +\r\n      theme(\r\n        plot.title = element_text(hjust = 0.5),\r\n        legend.position = \"bottom\"\r\n      ) +\r\n      scale_color_brewer(palette = \"Dark2\")+\r\n      scale_y_log10()\r\n  })\r\n}\r\n\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"}]
