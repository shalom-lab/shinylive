[{"name":"app.R","content":"library(shiny)\nlibrary(bslib)\nlibrary(ggplot2)\nlibrary(latex2exp)\n\nui <- page_fluid(\n  theme = bs_theme(bootswatch = \"flatly\"),\n  \n  h1(\"威布尔分布\"),\n  \n  layout_sidebar(\n    sidebar = sidebar(\n      title = \"参数设置\",\n      \n      sliderInput(\"shape\", \"形状参数 (k):\", \n                  min = 0.1, max = 5, value = 1.5, step = 0.1),\n      \n      sliderInput(\"scale\", \"尺度参数 (λ):\", \n                  min = 0.1, max = 5, value = 1, step = 0.1),\n      \n      sliderInput(\"xlim\", \"x轴范围:\", \n                  min = 0, max = 10, value = c(0, 5), step = 0.1),\n      \n      # 显示均值和方差\n      verbatimTextOutput(\"meanvar\")\n    ),\n    \n    # 使用navset_card_tab创建三个标签页\n    navset_card_tab(\n      # 第一个标签页：分布信息\n      nav_panel(\n        title = \"基本信息\",\n        card(\n          card_body(\n            p(\"威布尔分布(Weibull Distribution)是可靠性工程与生存分析中常用的概率分布。它能够描述各种形态的失效率函数，非常适合模拟系统的寿命数据。\"),\n            p(\"威布尔分布有两个参数：\"),\n            tags$ul(\n              tags$li(\"形状参数 k (shape): 决定了分布的形状\"),\n              tags$li(\"尺度参数 λ (scale): 决定了分布的尺度\")\n            ),\n            \n            h4(\"数学公式\"),\n            withMathJax(),\n            p(\"概率密度函数 (PDF):\"),\n            p(\"$$f(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}e^{-(t/\\\\lambda)^k}, \\\\quad t \\\\geq 0$$\"),\n            \n            p(\"累积分布函数 (CDF):\"),\n            p(\"$$F(t) = 1 - e^{-(t/\\\\lambda)^k}, \\\\quad t \\\\geq 0$$\"),\n            \n            p(\"生存函数 (Survival function):\"),\n            p(\"$$S(t) = e^{-(t/\\\\lambda)^k}, \\\\quad t \\\\geq 0$$\"),\n            \n            p(\"风险函数/危险率函数 (Hazard function):\"),\n            p(\"$$h(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}, \\\\quad t \\\\geq 0$$\"),\n            \n            h4(\"统计特性\"),\n            p(\"均值 (Mean):\"),\n            p(\"$$E(T) = \\\\lambda \\\\Gamma(1 + \\\\frac{1}{k})$$\"),\n            p(\"其中Γ是伽马函数。\"),\n            \n            p(\"方差 (Variance):\"),\n            p(\"$$Var(T) = \\\\lambda^2 \\\\left[ \\\\Gamma(1 + \\\\frac{2}{k}) - \\\\Gamma^2(1 + \\\\frac{1}{k}) \\\\right]$$\")\n          )\n        ),\n      ),\n      nav_panel(\n        title='生存分析中的应用',\n        card(\n          p(\"在生存分析中，威布尔分布具有重要意义：\"),\n          \n          h4(\"1. 生存函数 S(t)\"),\n          p(\"表示个体在时间t后仍然存活的概率。威布尔分布的生存函数为：\"),\n          p(\"$$S(t) = e^{-(t/\\\\lambda)^k}$$\"),\n          \n          h4(\"2. 危险率函数 h(t)\"),\n          p(\"表示在时间t存活的个体在下一时刻发生事件的瞬时概率。威布尔分布的危险率函数为：\"),\n          p(\"$$h(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}$$\"),\n          p(\"当k < 1时，危险率随时间减少，表示早期故障；\"),\n          p(\"当k = 1时，危险率恒定，简化为指数分布；\"),\n          p(\"当k > 1时，危险率随时间增加，表示磨损故障。\"),\n          \n          h4(\"3. 概率密度函数 f(t)\"),\n          p(\"表示事件发生时间的概率密度。威布尔分布的概率密度函数为：\"),\n          p(\"$$f(t) = \\\\frac{k}{\\\\lambda}\\\\left(\\\\frac{t}{\\\\lambda}\\\\right)^{k-1}e^{-(t/\\\\lambda)^k}$$\"),\n          \n          h4(\"应用场景\"),\n          p(\"威布尔分布在生存分析中广泛应用于：\"),\n          tags$ul(\n            tags$li(\"医学研究：分析患者存活时间\"),\n            tags$li(\"工程可靠性：预测设备失效时间\"),\n            tags$li(\"工业制造：研究产品寿命\"),\n            tags$li(\"保险精算：寿险和健康保险模型\")\n          )\n        )\n      ),\n      \n      # 第二个标签页：图形可视化\n      nav_panel(\n        title = \"分布图形\",\n        layout_column_wrap(\n          width = 1/2,\n          card(\n            card_header(\"概率密度函数 (PDF)\"),\n            plotOutput(\"pdfPlot\")\n          ),\n          card(\n            card_header(\"生存函数 (Survival Function)\"),\n            plotOutput(\"survivalPlot\")\n          )\n        ),\n        \n        layout_column_wrap(\n          width = 1/2,\n          card(\n            card_header(\"危险率函数 (Hazard Function)\"),\n            plotOutput(\"hazardPlot\")\n          ),\n          card(\n            card_header(\"累积分布函数 (CDF)\"),\n            plotOutput(\"cdfPlot\")\n          )\n        )\n      ),\n      \n      # 第三个标签页：参数影响\n      nav_panel(\n        title = \"参数影响分析\",\n        layout_column_wrap(\n          width = 1/3,\n          card(\n            card_header(\"形状参数(k)的影响\"),\n            card_body(\n              p(\"形状参数k对威布尔分布有显著影响:\"),\n              tags$ul(\n                tags$li(strong(\"k < 1: \"), \"危险率随时间减少。分布呈现出较高的初始失效率，适用于描述早期故障或婴儿期故障。\"),\n                tags$li(strong(\"k = 1: \"), \"危险率恒定，威布尔分布简化为指数分布。适用于描述随机故障。\"),\n                tags$li(strong(\"k > 1: \"), \"危险率随时间增加，适用于描述磨损故障。\"),\n                tags$li(strong(\"k ≈ 3.5: \"), \"威布尔分布近似正态分布。\")\n              ),\n              plotOutput(\"shapeEffect\")\n            )\n          ),\n          card(\n            card_header(\"尺度参数(λ)的影响\"),\n            card_body(\n              p(\"尺度参数λ主要影响分布的尺度（拉伸或压缩）:\"),\n              tags$ul(\n                tags$li(\"λ增大：分布向右拉伸，均值增加\"),\n                tags$li(\"λ减小：分布向左压缩，均值减小\"),\n                tags$li(\"λ等效于时间的单位变换\")\n              ),\n              plotOutput(\"scaleEffect\")\n            )\n          ),\n          card(\n            card_header(\"参数与统计特性的关系\"),\n            card_body(\n              p(\"参数变化对均值和方差的影响:\"),\n              withMathJax(),\n              p(\"当k固定时，λ增大会导致均值和方差同比例增加。\"),\n              p(\"当λ固定时，k的变化对均值和方差的影响更为复杂：\"),\n              tags$ul(\n                tags$li(\"k增大通常会使分布更加集中（方差减小）\"),\n                tags$li(\"当k接近3.6时，分布的偏度接近于0，最接近正态分布\")\n              ),\n              plotOutput(\"momentPlot\")\n            )\n          )\n        )\n      )\n    )\n  )\n)\n\nserver <- function(input, output) {\n  # 创建x轴数据点\n  x_values <- reactive({\n    seq(input$xlim[1], input$xlim[2], length.out = 500)\n  })\n  \n  # 计算威布尔PDF\n  weibull_pdf <- reactive({\n    dweibull(x_values(), shape = input$shape, scale = input$scale)\n  })\n  \n  # 计算威布尔CDF\n  weibull_cdf <- reactive({\n    pweibull(x_values(), shape = input$shape, scale = input$scale)\n  })\n  \n  # 计算威布尔生存函数\n  weibull_survival <- reactive({\n    1 - weibull_cdf()\n  })\n  \n  # 计算威布尔危险率函数\n  weibull_hazard <- reactive({\n    k <- input$shape\n    lambda <- input$scale\n    t <- x_values()\n    k/lambda * (t/lambda)^(k-1)\n  })\n  \n  # 绘制PDF图\n  output$pdfPlot <- renderPlot({\n    df <- data.frame(x = x_values(), y = weibull_pdf())\n    \n    ggplot(df, aes(x = x, y = y)) +\n      geom_line(color = \"#1f77b4\", size = 1.2) +\n      labs(\n        x = \"时间 (t)\",\n        y = \"概率密度 f(t)\",\n        title = paste0(\"威布尔PDF (k=\", input$shape, \", λ=\", input$scale, \")\")\n      ) +\n      theme_minimal(base_size = 14) +\n      theme(plot.title = element_text(hjust = 0.5)) +\n      coord_cartesian(xlim = input$xlim)\n  })\n  \n  # 绘制CDF图\n  output$cdfPlot <- renderPlot({\n    df <- data.frame(x = x_values(), y = weibull_cdf())\n    \n    ggplot(df, aes(x = x, y = y)) +\n      geom_line(color = \"#ff7f0e\", size = 1.2) +\n      labs(\n        x = \"时间 (t)\",\n        y = \"累积概率 F(t)\",\n        title = paste0(\"威布尔CDF (k=\", input$shape, \", λ=\", input$scale, \")\")\n      ) +\n      theme_minimal(base_size = 14) +\n      theme(plot.title = element_text(hjust = 0.5)) +\n      coord_cartesian(xlim = input$xlim)\n  })\n  \n  # 绘制生存函数图\n  output$survivalPlot <- renderPlot({\n    df <- data.frame(x = x_values(), y = weibull_survival())\n    \n    ggplot(df, aes(x = x, y = y)) +\n      geom_line(color = \"#2ca02c\", size = 1.2) +\n      labs(\n        x = \"时间 (t)\",\n        y = \"生存概率 S(t)\",\n        title = paste0(\"威布尔生存函数 (k=\", input$shape, \", λ=\", input$scale, \")\")\n      ) +\n      theme_minimal(base_size = 14) +\n      theme(plot.title = element_text(hjust = 0.5)) +\n      coord_cartesian(xlim = input$xlim)\n  })\n  \n  # 绘制危险率函数图\n  output$hazardPlot <- renderPlot({\n    df <- data.frame(x = x_values(), y = weibull_hazard())\n    \n    ggplot(df, aes(x = x, y = y)) +\n      geom_line(color = \"#d62728\", size = 1.2) +\n      labs(\n        x = \"时间 (t)\",\n        y = \"危险率 h(t)\",\n        title = paste0(\"威布尔危险率函数 (k=\", input$shape, \", λ=\", input$scale, \")\")\n      ) +\n      theme_minimal(base_size = 14) +\n      theme(plot.title = element_text(hjust = 0.5)) +\n      coord_cartesian(xlim = input$xlim)\n  })\n  \n  # 绘制形状参数影响图\n  output$shapeEffect <- renderPlot({\n    x <- seq(0, 5, length.out = 500)\n    shapes <- c(0.5, 1, 1.5, 3, 5)\n    \n    df <- data.frame()\n    for(shape in shapes) {\n      temp_df <- data.frame(\n        x = x,\n        y = dweibull(x, shape = shape, scale = input$scale),\n        shape = paste(\"k =\", shape)\n      )\n      df <- rbind(df, temp_df)\n    }\n    \n    ggplot(df, aes(x = x, y = y, color = shape)) +\n      geom_line(size = 1) +\n      labs(\n        x = \"时间 (t)\",\n        y = \"概率密度 f(t)\",\n        title = \"不同形状参数(k)的影响\",\n        color = \"形状参数\"\n      ) +\n      theme_minimal() +\n      theme(\n        plot.title = element_text(hjust = 0.5),\n        legend.position = \"bottom\"\n      ) +\n      scale_color_brewer(palette = \"Set1\")\n  })\n  \n  # 绘制尺度参数影响图\n  output$scaleEffect <- renderPlot({\n    x <- seq(0, 5, length.out = 500)\n    scales <- c(0.5, 1, 1.5, 2, 3)\n    \n    df <- data.frame()\n    for(scale in scales) {\n      temp_df <- data.frame(\n        x = x,\n        y = dweibull(x, shape = input$shape, scale = scale),\n        scale = paste(\"λ =\", scale)\n      )\n      df <- rbind(df, temp_df)\n    }\n    \n    ggplot(df, aes(x = x, y = y, color = scale)) +\n      geom_line(size = 1) +\n      labs(\n        x = \"时间 (t)\",\n        y = \"概率密度 f(t)\",\n        title = \"不同尺度参数(λ)的影响\",\n        color = \"尺度参数\"\n      ) +\n      theme_minimal() +\n      theme(\n        plot.title = element_text(hjust = 0.5),\n        legend.position = \"bottom\"\n      ) +\n      scale_color_brewer(palette = \"Set2\")\n  })\n  \n  # 绘制均值和方差与参数关系图\n  output$momentPlot <- renderPlot({\n    # 创建数据\n    k_values <- seq(0.2, 5, by = 0.1)\n    lambda_values <- c(0.5, 1, 2, 3)\n    \n    df <- data.frame()\n    \n    for(lambda in lambda_values) {\n      means <- sapply(k_values, function(k) lambda * gamma(1 + 1/k))\n      variances <- sapply(k_values, function(k) lambda^2 * (gamma(1 + 2/k) - (gamma(1 + 1/k))^2))\n      \n      mean_df <- data.frame(\n        x = k_values,\n        y = means,\n        parameter = paste0(\"λ = \", lambda),\n        type = \"均值\"\n      )\n      \n      var_df <- data.frame(\n        x = k_values,\n        y = variances,\n        parameter = paste0(\"λ = \", lambda),\n        type = \"方差\"\n      )\n      \n      df <- rbind(df, mean_df, var_df)\n    }\n    \n    # 绘图\n    ggplot(df, aes(x = x, y = y, color = parameter, linetype = type)) +\n      geom_line(size = 1) +\n      labs(\n        x = \"形状参数 (k)\",\n        y = \"值\",\n        title = \"形状参数(k)对均值和方差的影响\",\n        color = \"尺度参数\",\n        linetype = \"统计量\"\n      ) +\n      theme_minimal() +\n      theme(\n        plot.title = element_text(hjust = 0.5),\n        legend.position = \"bottom\"\n      ) +\n      scale_color_brewer(palette = \"Dark2\")+\n      scale_y_log10()\n  })\n}\n\nshinyApp(ui = ui, server = server)\n","type":"text"}]
